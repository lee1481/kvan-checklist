# 케이밴 제품 시공 점검표 웹앱 📋✍️

## 프로젝트 개요
케이밴 제품 시공 점검표를 디지털화한 **3페이지 구조의 터치 최적화 웹 애플리케이션**입니다. 
현장에서 터치로 체크하고, 디지털 서명 후 고객 이메일로 자동 발송하거나 PNG 이미지로 저장하는 스마트 점검표 시스템입니다.

## 🎨 새로운 3페이지 레이아웃 구조

### 📄 **Page 1: 메인 페이지** (A4 사이즈 한 페이지)
1. **시공 정보**
   - 시공일자
   - 고객명 + 고객 서명 캔버스
   - 고객 전화번호
   - 차량 차대번호
   - 주행거리

2. **품질보증서**
   - 5개 보증 조항
   - 7개 유상 수리 조건
   - 케이밴 연락처 정보

3. **시공자 정보**
   - 시공자명 + 시공자 서명 캔버스

4. **이메일 발송**
   - 이메일 주소 입력
   - 📧 이메일 발송 버튼

### 📦 **Page 2: 제품 선택 페이지**
- **기아PV5** (좌측)
  - 스마트패키지
  - 워크스테이션
  - 3단부품선반
  - 3단선반
- **밀워키PV5** (우측)
  - 스마트에디션
  - 워크스테이션
  - 3단부품선반
  - 3단선반
- **기타** (직접 입력)

### ✅ **Page 3: 체크리스트 페이지**
6개 체크리스트 섹션 (터치 체크박스):
- 차바닥 (태고합판, 알루미늄체크판, 부자재)
- 격벽타공판
- 격벽 2단 선반
- 3단 선반 (휠 좌측/우측)
- 부품 3단 선반 (휠 좌측/우측)
- 워크스페이스 (휠 우측)

## ✅ 완료된 기능

### 1. 🎨 3페이지 레이아웃 구조 (v2.0.0) 🆕
- ✅ **Page 1: 메인 페이지** - A4 사이즈 최적화
  - 시공 정보 (시공일자, 고객정보, 차량정보, 주행거리)
  - 고객 서명 캔버스 (시공 정보 내 통합)
  - 품질보증서 (5개 조항 + 유상수리 조건)
  - 시공자 정보 + 시공자 서명
  - 이메일 입력 및 발송 버튼
- ✅ **Page 2: 제품 선택 페이지**
  - 기아PV5 / 밀워키PV5 체크박스
  - 2단 레이아웃 (좌/우)
  - 기타 제품 직접 입력
- ✅ **Page 3: 체크리스트 페이지**
  - 6개 체크리스트 섹션
  - 50x50px 터치 체크박스
- ✅ 페이지 구분선 (점선 효과)
- ✅ A4 비율 최적화 (794px 최대 너비)

### 2. 태블릿 친화적 UI
- ✅ 큰 터치 영역의 체크박스 (50x50px)
- ✅ 반응형 디자인 (모바일/태블릿 최적화)
- ✅ 터치 피드백 애니메이션
- ✅ 확대/축소 방지 (user-scalable=no)

### 3. 시공 정보 입력 폼
- ✅ 시공일자 (Date picker)
- ✅ 고객명 + 고객 전화번호
- ✅ 차량 차대번호
- ✅ 주행거리 (km)
- ✅ **제품 시공명 선택** (Page 2)
  - 기아PV5 스마트패키지/워크스테이션/3단부품선반/3단선반
  - 밀워키PV5 스마트에디션/워크스테이션/3단부품선반/3단선반
  - **기타 (직접 입력)** 옵션 제공

### 4. 점검 체크리스트 (Page 3)
다음 6개 섹션으로 구성:
- ✅ 차바닥 (태고합판, 알루미늄체크판, 부자재)
- ✅ 격벽타공판
- ✅ 격벽 2단 선반
- ✅ 3단 선반 (휠 좌측/우측)
- ✅ 부품 3단 선반 (휠 좌측/우측)
- ✅ 워크스페이스 (휠 우측)

### 5. 디지털 서명 기능
- ✅ Canvas 기반 서명 패드
- ✅ 시공자 서명 (이름 + 서명) - Page 1 하단
- ✅ 고객 서명 (이름 + 서명) - Page 1 시공 정보 내
- ✅ 서명 지우기 기능
- ✅ 마우스 및 터치 입력 지원
- ✅ **좌표 정확도 개선 (v1.7.0)**
  - Canvas scale 비율 자동 계산
  - 마우스/터치 커서와 그려지는 선 정확히 일치
  - 모든 화면 크기에서 정확한 서명 가능

### 6. 📧 이메일 발송 기능
- ✅ **단일 이메일 주소 입력** (Page 1)
- ✅ Resend API 통합 완료
- ✅ HTML 이메일 템플릿 (CID 첨부 방식)
- ✅ 서명 이메일 첨부
- ✅ 발송 성공 알림

### 7. 📸 JPG 다운로드 기능 (v2.1.0) 🆕
- ✅ **Page 1 전용 JPG 다운로드** (카카오톡 전송용)
- ✅ 시공 정보 + 품질보증서 + 시공자 정보만 캡처
- ✅ 고품질 JPEG (scale 3×, 95% 품질)
- ✅ 파일명 자동 생성: `케이밴_점검표_{차대번호}_{날짜}.jpg`
- ✅ 카카오톡 전송에 최적화된 파일 크기 (1~2MB)
- ✅ 이메일 입력란은 제외하고 캡처
- ✅ 임시 컨테이너 방식으로 깔끔한 캡처

### 8. 🖼️ PNG 이미지 다운로드 기능
- ✅ **전체 페이지 PNG 생성** (scale 2.5×, 100% 품질)
- ✅ html2canvas 기반 렌더링
- ✅ 자연스러운 비율 유지 (800px 너비)
- ✅ 파일명 자동 생성: `케이밴_점검표_{차대번호}_{날짜}.png`
- ✅ 폰트/이미지 로딩 대기 후 캡처
- ✅ 선명한 텍스트 및 이미지 품질

### 9. 폼 유효성 검증
- ✅ **단일 이메일 주소 입력** (Page 1)
- ✅ Resend API 통합 완료
- ✅ HTML 이메일 템플릿 (CID 첨부 방식)
- ✅ 서명 이메일 첨부
- ✅ 발송 성공 알림

### 7. 📸 JPG 다운로드 기능 (v2.1.0) 🆕
- ✅ **Page 1 전용 JPG 다운로드** (카카오톡 전송용)
- ✅ 시공 정보 + 품질보증서 + 시공자 정보만 캡처
- ✅ 고품질 JPEG (scale 3×, 95% 품질)
- ✅ 파일명 자동 생성: `케이밴_점검표_{차대번호}_{날짜}.jpg`
- ✅ 카카오톡 전송에 최적화된 파일 크기 (1~2MB)
- ✅ 이메일 입력란은 제외하고 캡처
- ✅ 임시 컨테이너 방식으로 깔끔한 캡처

### 8. 🖼️ PNG 이미지 다운로드 기능
- ✅ **고품질 PNG 생성** (scale 2.5×, 100% 품질)
- ✅ html2canvas 기반 렌더링
- ✅ 자연스러운 비율 유지 (800px 너비)
- ✅ 파일명 자동 생성: `케이밴_점검표_{차대번호}_{날짜}.png`
- ✅ 폰트/이미지 로딩 대기 후 캡처
- ✅ 선명한 텍스트 및 이미지 품질

### 8. 폼 유효성 검증
- ✅ 필수 항목 입력 확인
- ✅ 이메일 형식 검증
- ✅ 서명 완료 여부 확인
- ✅ 사용자 친화적 오류 메시지
- ✅ 공통 검증 함수 (validateForm)

### 10. API 엔드포인트
- ✅ `POST /api/submit` - 점검표 제출 (이메일 발송)

## 🚧 제거된 기능 (v2.0.0)

- ❌ **사진 첨부 기능 제거** (v2.0.0)
  - 섹션별 사진 업로드 버튼 삭제
  - 사진 썸네일 미리보기 제거
  - 이미지 압축 로직 제거
  - 사진 관련 CSS/JavaScript 정리

- ❌ **다중 이메일 주소 입력 제거** (v2.0.0)
  - 이메일 주소 2, 3번 입력란 삭제
  - 단일 이메일 주소만 유지

- ❌ **PDF 다운로드 버튼 제거** (v2.0.0)
  - PNG 이미지 다운로드만 제공

## 🚧 구현 예정 기능

### 1. 데이터 저장 (선택적)
- ⏳ Cloudflare D1 데이터베이스 통합
- ⏳ 점검표 이력 조회
- ⏳ 통계 대시보드

### 2. 추가 기능
- ⏳ 오프라인 모드 (Service Worker)
- ⏳ 다국어 지원 (영문/중문)
- ⏳ QR 코드 생성 (점검표 링크 공유)

## 📡 현재 접속 URL

### 프로덕션 (Cloudflare Pages)
- **URL**: https://kvan-checklist.pages.dev ⭐
- **상태**: ⏳ 배포 대기 (Cloudflare API 키 설정 필요)
- **용도**: 실제 사용 (Production)
- **최신 기능**: 3페이지 레이아웃 + 📧 이메일 발송 + 🖼️ PNG 다운로드 + ✍️ 정확한 서명!

### 개발 서버 (Sandbox)
- **포트**: 3000
- **상태**: ✅ 활성 (PID: 6072)
- **용도**: 개발 및 테스트

## 🛠️ 기술 스택

### Frontend
- **HTML5** - 시맨틱 마크업
- **Tailwind CSS** - 스타일링 (CDN)
- **Vanilla JavaScript** - 인터랙티브 기능
- **Canvas API** - 디지털 서명
- **FileReader API** - 이미지 업로드 및 압축
- **Axios** - HTTP 클라이언트

### Backend
- **Hono** - 경량 웹 프레임워크
- **Cloudflare Workers** - Edge 런타임
- **Wrangler** - CLI 도구

### 개발 도구
- **Vite** - 빌드 도구
- **PM2** - 프로세스 관리 (개발 환경)
- **Git** - 버전 관리

## 📦 데이터 구조

### 점검표 제출 데이터
```json
{
  "installDate": "2026-02-15",
  "vehicleVin": "KMHXX00XXXX000000",
  "mileage": 50000,
  "productName": "기아PV5 스마트패키지, 밀워키PV5 3단선반",
  "productConfig": "기아PV5 스마트패키지, 밀워키PV5 3단선반",
  "installerName": "홍길동",
  "customerName": "김철수",
  "customerPhone": "010-1234-5678",
  "customerEmail": "customer@example.com",
  "emailList": ["customer@example.com"],
  "checklist": {
    "0": {
      "0": true,
      "1": true,
      "2": false,
      "3": true
    }
  },
  "installerSignature": "data:image/png;base64,...",
  "customerSignature": "data:image/png;base64,..."
}
```

## 🚀 로컬 개발 가이드

### 1. 프로젝트 시작
```bash
cd /home/user/webapp
npm install
```

### 2. 빌드
```bash
npm run build
```

### 3. 개발 서버 시작
```bash
# PM2로 시작 (권장)
pm2 start ecosystem.config.cjs

# 또는 직접 실행
npm run dev:sandbox
```

### 4. 테스트
```bash
curl http://localhost:3000
```

### 5. 로그 확인
```bash
pm2 logs kvan-checklist --nostream
```

## 📊 다음 개발 단계

### Phase 1: UI 레이아웃 재설계 ✅ 완료! (v2.0.0)
1. ✅ 3페이지 구조로 재설계
2. ✅ Page 1: 메인 페이지 (A4 사이즈 최적화)
3. ✅ Page 2: 제품 선택 페이지
4. ✅ Page 3: 체크리스트 페이지
5. ✅ 사진 첨부 기능 제거
6. ✅ 이메일 입력란 단일화
7. ✅ PNG 다운로드만 제공

### Phase 2: Cloudflare 배포 ⏳ 진행 중
1. ⏳ Cloudflare API 키 설정
2. ⏳ 프로덕션 배포
3. ⏳ 도메인 설정 (선택)

### Phase 3: 데이터 저장 (2-3일)
1. Cloudflare D1 데이터베이스 설정
2. 점검표 저장 로직 구현
3. 조회 API 개발
4. 관리자 대시보드 (간단한 버전)

### Phase 4: 추가 기능 (3-5일)
1. 오프라인 모드 (Service Worker)
2. QR 코드 생성
3. 통계 및 리포트

## 🎉 최신 업데이트 (v2.1.0)

### 2026-02-15: Page 1 JPG 다운로드 기능 추가! 📸 (v2.1.0)
- ✅ **카카오톡 전송용 JPG 다운로드**
  - Page 1만 선택적으로 캡처 (시공 정보 + 품질보증서 + 시공자 정보)
  - 이메일 입력란은 제외하고 캡처
  - 임시 컨테이너 방식으로 깔끔한 이미지 생성
- ✅ **고품질 JPEG 출력**
  - scale 3× (고해상도)
  - 95% 품질
  - 파일 크기 1~2MB (카카오톡 전송 최적화)
- ✅ **2개 버튼 구성**
  - 📧 이메일 발송 버튼 (좌측, 파란색)
  - 📸 JPG 다운로드 버튼 (우측, 초록색)
- ✅ **파일명 자동 생성**
  - `케이밴_점검표_{차대번호}_{날짜}.jpg`
- ✅ **다운로드 후 안내 메시지**
  - "카카오톡으로 고객에게 전송해주세요" 알림

### 2026-02-15: UI 레이아웃 대폭 재설계! 🎨 (v2.0.0)
- ✅ **3페이지 구조로 완전 재설계**
  - Page 1: 메인 페이지 (시공정보 + 품질보증서 + 시공자 + 이메일)
  - Page 2: 제품 선택 페이지
  - Page 3: 체크리스트 페이지
- ✅ **A4 사이즈 최적화**
  - 메인 페이지 794px 최대 너비
  - 페이지 구분선 (점선 효과)
- ✅ **사진 첨부 기능 제거**
  - 사진 버튼, 썸네일 미리보기, 압축 로직 모두 제거
  - 간소화된 UI
- ✅ **이메일 입력란 단일화**
  - 이메일 주소 2, 3번 제거
  - 단일 이메일 입력만 유지
- ✅ **고객 서명 위치 변경**
  - 시공 정보 섹션 내부로 이동
  - 고객명 → 고객 서명 → 전화번호 → 차대번호 → 주행거리 순서
- ✅ **시공자 정보 독립 섹션**
  - 품질보증서 아래 별도 섹션
  - 시공자명 + 시공자 서명
- ✅ **이메일 발송 독립 섹션**
  - 시공자 정보 아래 별도 섹션
  - 이메일 입력 + 발송 버튼
- ✅ **PNG 다운로드 버튼 분리**
  - 하단에 독립 버튼 배치
  - 이메일 발송과 분리
- ✅ **빌드 최적화**
  - 104.15 kB (사진 기능 제거로 경량화)
  - 빠른 로딩 속도

## 📞 케이밴 경북지사 정보

- **전화**: 053-XXX-XXXX
- **이메일**: kvan@example.com
- **A/S 보증**: 3년 또는 6만km (선도래 기준)

## 📝 라이선스

© 2026 케이밴. All Rights Reserved.

---

**최종 업데이트**: 2026년 2월 15일  
**개발자**: 사인마스터 (AI 기반 간판 디자인 자동화 전문가)  
**버전**: v2.1.0 (Page 1 JPG 다운로드 - 카카오톡 전송용)

### 최신 배포 정보
- **Cloudflare Pages**: ⏳ 배포 대기 중 (API 키 설정 필요)
- **Production URL**: https://kvan-checklist.pages.dev
- **GitHub**: https://github.com/lee1481/kvan-checklist.git
- **Commit**: 17655cf (Page 1 JPG 다운로드 기능 추가)
- **빌드 크기**: 109.50 kB
- **배포 일시**: 2026-02-15 (배포 대기)
